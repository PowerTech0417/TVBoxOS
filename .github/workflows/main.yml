name: TVBox Multi-Build

on:
  workflow_dispatch:
    inputs:
      user_name:
        description: 'GitHubç”¨æˆ·å'
        required: true
        default: 'q215613905'
        type: string
      repo_name:
        description: 'ä»“åº“å'
        required: true
        default: 'TVBoxOS'
        type: string
      branch_name:
        description: 'åˆ†æ”¯å'
        required: true
        default: 'main'
        type: string
      build_types:
        description: 'æž„å»ºç±»åž‹'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - mobile
          - tv
          - mobile_debug
          - tv_debug
      architectures:
        description: 'æž¶æž„ç±»åž‹'
        required: true
        default: 'universal'
        type: choice
        options:
          - universal
          - arm64
          - arm7
          - separate

  schedule:
    - cron: '0 13 1 * *'

jobs:
  generate-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    
    steps:
      - name: Generate Build Matrix
        id: set-matrix
        run: |
          # æ ¹æ®è¾“å…¥å‚æ•°ç”Ÿæˆæž„å»ºçŸ©é˜µ
          BUILD_TYPES="${{ github.event.inputs.build_types || 'all' }}"
          ARCHS="${{ github.event.inputs.architectures || 'universal' }}"
          
          # åˆå§‹åŒ–çŸ©é˜µæ•°ç»„
          MATRIX_ENTRIES="["
          
          # å®šä¹‰æž„å»ºç±»åž‹
          if [ "$BUILD_TYPES" = "all" ]; then
            TYPES=("mobile" "tv")
          else
            TYPES=("$BUILD_TYPES")
          fi
          
          # å®šä¹‰æž¶æž„
          if [ "$ARCHS" = "universal" ]; then
            ARCH_LIST=("universal")
          elif [ "$ARCHS" = "separate" ]; then
            ARCH_LIST=("arm64" "arm7")
          else
            ARCH_LIST=("$ARCHS")
          fi
          
          FIRST=true
          for TYPE in "${TYPES[@]}"; do
            for ARCH in "${ARCH_LIST[@]}"; do
              # è®¾ç½®å˜ä½“åç§°
              if [ "$TYPE" = "mobile" ]; then
                VARIANT="Release"
                if [[ "$ARCH" == "universal" ]]; then
                  ABI_FILTERS='""'
                elif [[ "$ARCH" == "arm64" ]]; then
                  ABI_FILTERS='["arm64-v8a"]'
                elif [[ "$ARCH" == "arm7" ]]; then
                  ABI_FILTERS='["armeabi-v7a"]'
                else
                  ABI_FILTERS='""'
                fi
              elif [ "$TYPE" = "tv" ]; then
                VARIANT="TvRelease"
                if [[ "$ARCH" == "universal" ]]; then
                  ABI_FILTERS='""'
                elif [[ "$ARCH" == "arm64" ]]; then
                  ABI_FILTERS='["arm64-v8a"]'
                elif [[ "$ARCH" == "arm7" ]]; then
                  ABI_FILTERS='["armeabi-v7a"]'
                else
                  ABI_FILTERS='""'
                fi
              elif [[ "$TYPE" == *"debug" ]]; then
                VARIANT="Debug"
                ABI_FILTERS='""'
              else
                VARIANT="Release"
                ABI_FILTERS='""'
              fi
              
              # æž„å»º JSON æ¡ç›®
              if [ "$FIRST" = true ]; then
                FIRST=false
              else
                MATRIX_ENTRIES="$MATRIX_ENTRIES,"
              fi
              
              MATRIX_ENTRIES="$MATRIX_ENTRIES{\"build_type\":\"$TYPE\",\"architecture\":\"$ARCH\",\"variant\":\"$VARIANT\",\"abi_filters\":$ABI_FILTERS}"
            done
          done
          
          MATRIX_ENTRIES="$MATRIX_ENTRIES]"
          
          echo "matrix=$MATRIX_ENTRIES" >> $GITHUB_OUTPUT
          echo "Generated matrix: $MATRIX_ENTRIES"

  build:
    needs: generate-matrix
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{ fromJson(needs.generate-matrix.outputs.matrix) }}
      max-parallel: 4
    
    steps:
      - name: Checkout Workflow Code
        uses: actions/checkout@v4
        
      - name: Display Build Configuration
        run: |
          echo "ðŸŽ¯ æž„å»ºé…ç½®:"
          echo "ç±»åž‹: ${{ matrix.build_type }}"
          echo "æž¶æž„: ${{ matrix.architecture }}"
          echo "å˜ä½“: ${{ matrix.variant }}"
          echo "ABI: ${{ matrix.abi_filters || 'all' }}"
          
      - name: Clone Source Code
        run: |
          USER_NAME="${{ github.event.inputs.user_name || 'q215613905' }}"
          REPO_NAME="${{ github.event.inputs.repo_name || 'TVBoxOS' }}"
          BRANCH_NAME="${{ github.event.inputs.branch_name || 'main' }}"
          
          echo "ðŸ“¥ å…‹éš†ä»“åº“: $USER_NAME/$REPO_NAME:$BRANCH_NAME"
          git clone https://github.com/$USER_NAME/$REPO_NAME.git TVBoxOSC
          cd TVBoxOSC
          git checkout $BRANCH_NAME
          
          # èŽ·å–æäº¤ä¿¡æ¯
          COMMIT_HASH=$(git rev-parse --short HEAD)
          COMMIT_DATE=$(git log -1 --format="%cd" --date=format:"%Y%m%d-%H%M")
          COMMIT_MSG=$(git log -1 --format="%s")
          
          echo "commit=$COMMIT_HASH" >> $GITHUB_ENV
          echo "commit_date=$COMMIT_DATE" >> $GITHUB_ENV
          echo "commit_msg=$COMMIT_MSG" >> $GITHUB_ENV
          echo "tag=TVBox-${COMMIT_DATE}" >> $GITHUB_ENV
          
      - name: Setup Build Environment
        working-directory: TVBoxOSC
        run: |
          echo "ðŸ”§ è®¾ç½®æž„å»ºçŽ¯å¢ƒ..."
          
          # å®‰è£…å¿…è¦å·¥å…·
          apt-get update && apt-get install -y curl unzip zip jq
          
          # åˆ›å»ºå¿…è¦çš„é…ç½®æ–‡ä»¶
          cat > local.properties << 'EOF'
sdk.dir=/usr/local/lib/android/sdk
EOF
          
          # é…ç½® gradle.properties
          cat > gradle.properties << 'EOF'
org.gradle.jvmargs=-Xmx4096m -Dfile.encoding=UTF-8
org.gradle.parallel=true
org.gradle.daemon=true
org.gradle.caching=true
org.gradle.configureondemand=true
android.enableBuildCache=true
EOF
          
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          
      - name: Setup Android SDK
        uses: android-actions/setup-android@v3
        
      - name: Setup Python for Chaquopy
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: Configure Chaquopy
        working-directory: TVBoxOSC
        run: |
          echo "ðŸ é…ç½® Chaquopy..."
          
          PYTHON_PATH=$(which python3)
          echo "Python è·¯å¾„: $PYTHON_PATH"
          
          # æ·»åŠ åˆ° gradle.properties
          echo "" >> gradle.properties
          echo "# Chaquopy é…ç½®" >> gradle.properties
          echo "chaquopy.python=$PYTHON_PATH" >> gradle.properties
          echo "chaquopy.pip=install" >> gradle.properties
          
          # ä¿®å¤ Windows è·¯å¾„
          find . -name "*.gradle" -type f -exec sed -i "s|D:/Programs/Python/.*python.exe|$PYTHON_PATH|gi" {} \;
          find . -name "*.gradle" -type f -exec sed -i "s|C:/.*python.exe|$PYTHON_PATH|gi" {} \;
          
          # å®‰è£… Python ä¾èµ–
          python3 -m pip install --upgrade pip
          if [ -f "pyramid/requirements.txt" ]; then
            echo "å®‰è£… Python ä¾èµ–..."
            python3 -m pip install -r pyramid/requirements.txt
          fi
          
      - name: Modify Version and Build Configuration
        working-directory: TVBoxOSC
        run: |
          echo "âš™ï¸ ä¿®æ”¹æž„å»ºé…ç½®..."
          
          BUILD_TYPE="${{ matrix.build_type }}"
          ARCH="${{ matrix.architecture }}"
          VARIANT="${{ matrix.variant }}"
          TAG="${{ env.tag }}"
          
          # ä¿®æ”¹ç‰ˆæœ¬åç§°
          if [ -f "app/build.gradle" ]; then
            # å¤‡ä»½
            cp app/build.gradle app/build.gradle.bak
            
            # ä¿®æ”¹ç‰ˆæœ¬åç§°
            sed -i "/versionName/s/versionName .*/versionName \"${TAG}-${BUILD_TYPE}-${ARCH}\"/" app/build.gradle
            
            echo "âœ… ç‰ˆæœ¬åç§°ä¿®æ”¹ä¸º: ${TAG}-${BUILD_TYPE}-${ARCH}"
          fi
          
          # ä¿®æ”¹å…³äºŽé¡µé¢
          if [ -f "app/src/main/res/layout/dialog_about.xml" ]; then
            sed -i "/android:text=/s/=\"[^\"]*\"/=\"${TAG}-${BUILD_TYPE}-${ARCH}\\næž„å»ºæ—¶é—´: $(date '+%Y-%m-%d %H:%M')\\n\\n\"/" app/src/main/res/layout/dialog_about.xml
          fi
          
      - name: Configure ABI Filters
        working-directory: TVBoxOSC
        run: |
          echo "ðŸ—ï¸ é…ç½®æž¶æž„è¿‡æ»¤å™¨..."
          
          # èŽ·å– ABI è¿‡æ»¤å™¨é…ç½®
          ABI_CONFIG='${{ matrix.abi_filters }}'
          
          if [ "$ABI_CONFIG" != '""' ] && [ "$ABI_CONFIG" != "" ]; then
            echo "è®¾ç½® ABI è¿‡æ»¤å™¨: $ABI_CONFIG"
            
            # åœ¨ app/build.gradle ä¸­æ·»åŠ  ndk é…ç½®
            if [ -f "app/build.gradle" ]; then
              # æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ defaultConfig å—
              if grep -q "defaultConfig" app/build.gradle; then
                # æ ¹æ®é…ç½®è®¾ç½®è¿‡æ»¤å™¨
                if [ "$ABI_CONFIG" = '["arm64-v8a"]' ]; then
                  # åœ¨ defaultConfig ä¸­æ·»åŠ  ndk é…ç½®
                  sed -i '/defaultConfig {/a\
        ndk {\
            abiFilters "arm64-v8a"\
        }' app/build.gradle
                  echo "å·²è®¾ç½® arm64-v8a è¿‡æ»¤å™¨"
                elif [ "$ABI_CONFIG" = '["armeabi-v7a"]' ]; then
                  # åœ¨ defaultConfig ä¸­æ·»åŠ  ndk é…ç½®
                  sed -i '/defaultConfig {/a\
        ndk {\
            abiFilters "armeabi-v7a"\
        }' app/build.gradle
                  echo "å·²è®¾ç½® armeabi-v7a è¿‡æ»¤å™¨"
                fi
              fi
            fi
          else
            echo "æž„å»ºæ‰€æœ‰æž¶æž„ï¼ˆæ— è¿‡æ»¤å™¨ï¼‰"
          fi
          
      - name: Configure Signing
        working-directory: TVBoxOSC
        run: |
          echo "ðŸ” é…ç½®ç­¾å..."
          
          # æ£€æŸ¥å¹¶å¤åˆ¶ç­¾åæ–‡ä»¶
          if [ -f "${{ github.workspace }}/.github/workflows/TVBoxOSC.jks" ]; then
            cp "${{ github.workspace }}/.github/workflows/TVBoxOSC.jks" app/
            
            cat >> gradle.properties << 'EOF'

# ç­¾åé…ç½®
RELEASE_STORE_FILE=./TVBoxOSC.jks
RELEASE_KEY_ALIAS=TVBoxOSC
RELEASE_STORE_PASSWORD=TVBoxOSC
RELEASE_KEY_PASSWORD=TVBoxOSC
EOF
            
            echo "âœ… ç­¾åé…ç½®å·²æ·»åŠ "
          else
            echo "âš ï¸  ä½¿ç”¨è°ƒè¯•ç­¾å"
            # åˆ›å»ºè°ƒè¯•ç­¾åé…ç½®
            cat >> gradle.properties << 'EOF'

# è°ƒè¯•ç­¾å
android.injected.signing.store.file=$HOME/.android/debug.keystore
android.injected.signing.store.password=android
android.injected.signing.key.alias=androiddebugkey
android.injected.signing.key.password=android
EOF
          fi
          
      - name: Prepare Gradle Wrapper
        working-directory: TVBoxOSC
        run: |
          echo "ðŸ“¦ å‡†å¤‡ Gradle..."
          
          if [ -f "gradlew" ]; then
            chmod +x gradlew
            sed -i '1s|.*|#!/usr/bin/env bash|' gradlew
            echo "âœ… gradlew å·²ä¿®å¤"
          fi
          
      - name: Build APK
        working-directory: TVBoxOSC
        env:
          ANDROID_HOME: /usr/local/lib/android/sdk
          ANDROID_SDK_ROOT: /usr/local/lib/android/sdk
        run: |
          echo "ðŸ—ï¸ å¼€å§‹æž„å»º: ${{ matrix.variant }}"
          
          # æž„å»ºå‘½ä»¤
          BUILD_CMD="./gradlew :app:assemble${{ matrix.variant }}"
          
          echo "æ‰§è¡Œå‘½ä»¤: $BUILD_CMD"
          
          # æ‰§è¡Œæž„å»º
          $BUILD_CMD \
            --build-cache \
            --parallel \
            --stacktrace \
            --warning-mode all \
            --info
          
          echo "âœ… æž„å»ºå®Œæˆ"
          
      - name: Process APK Files
        working-directory: TVBoxOSC
        run: |
          echo "ðŸ“¦ å¤„ç† APK æ–‡ä»¶..."
          
          BUILD_TYPE="${{ matrix.build_type }}"
          ARCH="${{ matrix.architecture }}"
          VARIANT="${{ matrix.variant }}"
          TAG="${{ env.tag }}"
          
          # åˆ›å»ºè¾“å‡ºç›®å½•
          OUTPUT_DIR="output/${BUILD_TYPE}/${ARCH}"
          mkdir -p "$OUTPUT_DIR"
          
          # æŸ¥æ‰¾ APK æ–‡ä»¶
          APK_DIR="app/build/outputs/apk/${{ matrix.variant | lower }}"
          
          if [ -d "$APK_DIR" ]; then
            echo "APK ç›®å½•: $APK_DIR"
            
            # å¤„ç†ä¸åŒæž¶æž„çš„ APK
            case "$ARCH" in
              "universal")
                # é€šç”¨ç‰ˆæœ¬ï¼ˆåŒ…å«æ‰€æœ‰æž¶æž„ï¼‰
                APK_FILE=$(find "$APK_DIR" -name "*universal*.apk" -o -name "*noabi*.apk" | head -1)
                if [ -n "$APK_FILE" ]; then
                  NEW_NAME="TVBox-${BUILD_TYPE}-universal-${TAG}.apk"
                  cp "$APK_FILE" "$OUTPUT_DIR/$NEW_NAME"
                  echo "ðŸ“± é€šç”¨ç‰ˆæœ¬: $NEW_NAME"
                fi
                ;;
                
              "arm64")
                # ARM64 ç‰ˆæœ¬
                APK_FILE=$(find "$APK_DIR" -name "*arm64-v8a*.apk" | head -1)
                if [ -n "$APK_FILE" ]; then
                  NEW_NAME="TVBox-${BUILD_TYPE}-arm64-${TAG}.apk"
                  cp "$APK_FILE" "$OUTPUT_DIR/$NEW_NAME"
                  echo "ðŸ“± ARM64 ç‰ˆæœ¬: $NEW_NAME"
                fi
                ;;
                
              "arm7")
                # ARM7 ç‰ˆæœ¬
                APK_FILE=$(find "$APK_DIR" -name "*armeabi-v7a*.apk" | head -1)
                if [ -n "$APK_FILE" ]; then
                  NEW_NAME="TVBox-${BUILD_TYPE}-arm7-${TAG}.apk"
                  cp "$APK_FILE" "$OUTPUT_DIR/$NEW_NAME"
                  echo "ðŸ“± ARM7 ç‰ˆæœ¬: $NEW_NAME"
                fi
                ;;
                
              "separate")
                # åˆ†ç¦»ç‰ˆæœ¬ - å¤åˆ¶æ‰€æœ‰æž¶æž„
                for APK_FILE in $(find "$APK_DIR" -name "*.apk"); do
                  FILENAME=$(basename "$APK_FILE")
                  NEW_NAME="TVBox-${BUILD_TYPE}-${FILENAME}"
                  cp "$APK_FILE" "$OUTPUT_DIR/$NEW_NAME"
                  echo "ðŸ“± $NEW_NAME"
                done
                ;;
            esac
            
            # å¦‚æžœæ²¡æœ‰æ‰¾åˆ°ç‰¹å®šæž¶æž„çš„ APKï¼Œå°è¯•æŸ¥æ‰¾é»˜è®¤ APK
            if [ ! "$(ls -A "$OUTPUT_DIR" 2>/dev/null)" ]; then
              echo "âš ï¸  æœªæ‰¾åˆ°ç‰¹å®šæž¶æž„ APKï¼Œå°è¯•æŸ¥æ‰¾é»˜è®¤ APK..."
              DEFAULT_APK=$(find "$APK_DIR" -name "*.apk" | head -1)
              if [ -n "$DEFAULT_APK" ]; then
                NEW_NAME="TVBox-${BUILD_TYPE}-${ARCH}-${TAG}.apk"
                cp "$DEFAULT_APK" "$OUTPUT_DIR/$NEW_NAME"
                echo "ðŸ“± é»˜è®¤ç‰ˆæœ¬: $NEW_NAME"
              fi
            fi
          else
            echo "âŒ æœªæ‰¾åˆ° APK ç›®å½•: $APK_DIR"
          fi
          
          # æ˜¾ç¤ºè¾“å‡ºæ–‡ä»¶
          echo "ðŸ“ è¾“å‡ºæ–‡ä»¶åˆ—è¡¨:"
          find "output" -name "*.apk" -type f | while read file; do
            SIZE=$(du -h "$file" | cut -f1)
            echo "  $file ($SIZE)"
          done
          
      - name: Create Build Report
        working-directory: TVBoxOSC
        run: |
          echo "ðŸ“‹ åˆ›å»ºæž„å»ºæŠ¥å‘Š..."
          
          BUILD_TYPE="${{ matrix.build_type }}"
          ARCH="${{ matrix.architecture }}"
          
          REPORT_DIR="output/${BUILD_TYPE}/${ARCH}"
          mkdir -p "$REPORT_DIR"
          
          cat > "$REPORT_DIR/build-report.md" << EOF
# TVBox æž„å»ºæŠ¥å‘Š
**æž„å»ºç±»åž‹**: ${BUILD_TYPE}
**æž¶æž„**: ${ARCH}
**å˜ä½“**: ${{ matrix.variant }}
**ç‰ˆæœ¬**: ${{ env.tag }}
**æäº¤**: ${{ env.commit }}
**æäº¤ä¿¡æ¯**: ${{ env.commit_msg }}
**æž„å»ºæ—¶é—´**: $(date)
**è§¦å‘æ–¹å¼**: ${{ github.event_name }}

## æ–‡ä»¶åˆ—è¡¨
EOF
          
          # æ·»åŠ æ–‡ä»¶åˆ—è¡¨
          find "$REPORT_DIR" -name "*.apk" -type f | while read file; do
            FILENAME=$(basename "$file")
            SIZE=$(du -h "$file" | cut -f1)
            MD5=$(md5sum "$file" | cut -d' ' -f1)
            echo "- **${FILENAME}** (${SIZE})" >> "$REPORT_DIR/build-report.md"
            echo "  - MD5: \`${MD5}\`" >> "$REPORT_DIR/build-report.md"
          done
          
          echo "âœ… æž„å»ºæŠ¥å‘Šå·²åˆ›å»º"
          
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: TVBox-${{ matrix.build_type }}-${{ matrix.architecture }}-${{ env.tag }}
          path: TVBoxOSC/output/${{ matrix.build_type }}/${{ matrix.architecture }}/*
          retention-days: 30
          
  combine-artifacts:
    needs: build
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: Download All Artifacts
        uses: actions/download-artifact@v4
        with:
          path: all-artifacts
          
      - name: Create Combined Release
        run: |
          echo "ðŸ“¦ åˆ›å»ºç»¼åˆå‘å¸ƒåŒ…..."
          
          mkdir -p combined-release
          
          # å¤åˆ¶æ‰€æœ‰ APK æ–‡ä»¶
          find all-artifacts -name "*.apk" -type f | while read apk; do
            cp "$apk" combined-release/
          done
          
          # å¤åˆ¶æ‰€æœ‰æŠ¥å‘Šæ–‡ä»¶
          find all-artifacts -name "*.md" -type f | while read report; do
            cp "$report" combined-release/
          done
          
          # åˆ›å»ºæ€»è§ˆæ–‡ä»¶
          cat > combined-release/OVERVIEW.md << 'EOF'
# TVBox ç»¼åˆæž„å»ºåŒ…
æ­¤åŒ…åŒ…å«æ‰€æœ‰æž„å»ºç‰ˆæœ¬çš„ APK æ–‡ä»¶ã€‚

## åŒ…å«çš„ç‰ˆæœ¬
EOF
          
          # æ·»åŠ æ–‡ä»¶åˆ—è¡¨
          find combined-release -name "*.apk" -type f | sort | while read file; do
            FILENAME=$(basename "$file")
            SIZE=$(du -h "$file" | cut -f1)
            echo "- **${FILENAME}** (${SIZE})" >> combined-release/OVERVIEW.md
          done
          
          cat >> combined-release/OVERVIEW.md << 'EOF'

## ä½¿ç”¨è¯´æ˜Ž
1. **æ‰‹æœºç‰ˆ (mobile)**: é€‚ç”¨äºŽæ‰‹æœºå’Œå¹³æ¿è®¾å¤‡
2. **TVç‰ˆ (tv)**: ä¸“ä¸ºç”µè§†ä¼˜åŒ–ï¼Œæ”¯æŒé¥æŽ§å™¨æ“ä½œ
3. **æž¶æž„è¯´æ˜Ž**:
   - **universal**: åŒ…å«æ‰€æœ‰ CPU æž¶æž„
   - **arm64**: ä»… ARM64 æž¶æž„ (çŽ°ä»£è®¾å¤‡)
   - **arm7**: ä»… ARMv7 æž¶æž„ (æ—§è®¾å¤‡)
   - **separate**: å„æž¶æž„ç‹¬ç«‹ç‰ˆæœ¬

## æž„å»ºä¿¡æ¯
- æž„å»ºæ—¶é—´: $(date)
- è§¦å‘æ–¹å¼: ${{ github.event_name }}
- æ€»æ–‡ä»¶æ•°: $(find combined-release -name "*.apk" | wc -l) ä¸ª APK æ–‡ä»¶
EOF
          
          # åˆ›å»º ZIP åŒ…
          cd combined-release
          zip -r "../TVBox-All-Builds-${{ env.tag }}.zip" .
          cd ..
          
          echo "ðŸ“ æ–‡ä»¶åˆ—è¡¨:"
          ls -la combined-release/
          echo "ðŸ“¦ ZIP åŒ…å¤§å°: $(du -h TVBox-All-Builds-${{ env.tag }}.zip | cut -f1)"
          
      - name: Upload Combined Release
        uses: actions/upload-artifact@v4
        with:
          name: TVBox-Complete-Builds-${{ env.tag }}
          path: |
            TVBox-All-Builds-${{ env.tag }}.zip
            combined-release/
          retention-days: 30
          
      - name: Build Summary
        run: |
          echo "========================================"
          echo "ðŸŽ‰ æž„å»ºå®Œæˆæ€»ç»“"
          echo "========================================"
          echo "æ€»æž„å»ºä»»åŠ¡: ${{ needs.build.result }}"
          echo "æœ€ç»ˆç‰ˆæœ¬: ${{ env.tag }}"
          echo "åŒ…å«çš„æž„å»ºç±»åž‹:"
          echo "  - æ‰‹æœºç‰ˆ (mobile)"
          echo "  - TVç‰ˆ (tv)"
          echo "åŒ…å«çš„æž¶æž„:"
          echo "  - Universal (å…¨æž¶æž„)"
          echo "  - ARM64"
          echo "  - ARM7"
          echo "  - ç‹¬ç«‹ç‰ˆæœ¬"
          echo "========================================"
          echo "ðŸ“¦ äº§ç‰©å·²ä¸Šä¼ åˆ° Artifacts"
          echo "========================================"
          
  cleanup:
    needs: [build, combine-artifacts]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: Clean Up Old Workflows
        uses: Mattraks/delete-workflow-runs@main
        with:
          token: ${{ github.token }}
          repository: ${{ github.repository }}
          retain_days: 14
          keep_minimum_runs: 10
