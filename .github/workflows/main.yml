# ä¿®å¤çš„ç¬¬175è¡Œé™„è¿‘
- name: Configure ABI Filters
  working-directory: TVBoxOSC
  run: |
    echo "ğŸ—ï¸ é…ç½®æ¶æ„è¿‡æ»¤å™¨..."
    
    # è·å–æ¶æ„ä¿¡æ¯
    ARCH="${{ matrix.architecture }}"
    ABI_FILTER="${{ matrix.abi_filters }}"
    
    echo "æ¶æ„: $ARCH"
    echo "ABIè¿‡æ»¤å™¨: $ABI_FILTER"
    
    # æ ¹æ®æ¶æ„é…ç½®è¿‡æ»¤å™¨
    if [ "$ABI_FILTER" = "arm64" ]; then
      echo "è®¾ç½® ARM64 æ¶æ„è¿‡æ»¤å™¨..."
      
      # åœ¨ app/build.gradle ä¸­æ·»åŠ  ndk é…ç½®
      if [ -f "app/build.gradle" ]; then
        # æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ defaultConfig å—
        if grep -q "defaultConfig" app/build.gradle; then
          # åœ¨ defaultConfig ä¸­æ·»åŠ  ndk é…ç½®
          sed -i '/defaultConfig {/a\
  ndk {\
      abiFilters "arm64-v8a"\
  }' app/build.gradle
          echo "âœ… å·²è®¾ç½® arm64-v8a è¿‡æ»¤å™¨"
        fi
      fi
      
    elif [ "$ABI_FILTER" = "arm7" ]; then
      echo "è®¾ç½® ARM7 æ¶æ„è¿‡æ»¤å™¨..."
      
      # åœ¨ app/build.gradle ä¸­æ·»åŠ  ndk é…ç½®
      if [ -f "app/build.gradle" ]; then
        # æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ defaultConfig å—
        if grep -q "defaultConfig" app/build.gradle; then
          # åœ¨ defaultConfig ä¸­æ·»åŠ  ndk é…ç½®
          sed -i '/defaultConfig {/a\
  ndk {\
      abiFilters "armeabi-v7a"\
  }' app/build.gradle
          echo "âœ… å·²è®¾ç½® armeabi-v7a è¿‡æ»¤å™¨"
        fi
      fi
      
    else
      echo "æ„å»ºæ‰€æœ‰æ¶æ„ï¼ˆæ— è¿‡æ»¤å™¨ï¼‰"
    fi
